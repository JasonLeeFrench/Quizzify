(function(e){e.quizzify=function(t,n){var r,i,s;var o={container:"quiz_container",answers_array:[],results_array:[],number_of_questions:0,quiz_finished:false,init:function(e,t){r=this;if(t){for(var n in t){r[n]=t[n]}}if(typeof e==="string"){r.tabletop_load(e)}else{}r.create_cover();return r},build_answers_array:function(e){return Array.apply(null,new Array(e)).map(Number.prototype.valueOf,0)},do_results:function(t,n){var r=n[1],i=n[0],s=e(".results"),o=[];var u=t[0];var a=0;for(var f=1;f<t.length;f++){if(t[f]>u){a=f;u=t[f]}}for(var f=0;f<t.length;f++){if(t[f]===u){o.push(f)}}var l=o[Math.floor(Math.random()*o.length)];s.removeClass("hidden");s.append(e("<h2>"+r[l]+"</h2>"));s.append(e("<p>"+i[l]+"</p>"))},do_answer:function(t,n){question_id=e(".question_"+n);if(question_id.hasClass("answered")){r.answers_array[parseInt(question_id.find("input:checked").attr("id").split(",")[0])]-=1}r.answers_array[t]+=1;if(r.total_answered(r.answers_array)===r.number_of_questions){r.do_results(r.answers_array,r.results_array);e(".quiz_container").addClass("complete");e("html,body").animate({scrollTop:e(".results").offset().top},"slow");r.quiz_finished=true}},create_cover:function(){i=e("#"+r.container);s=e("<ul></ul>");i.append(s);s.addClass("quiz_container");s.css({width:s.parent().width()})},total_answered:function(e){var t=0;for(var n=0;n<e.length;n++){t+=e[n]}return t},do_bindings:function(t){t.on("click",function(t){var n=e(this).find("input"),i=n.attr("id").split(","),s=i[0],o=i[1],u=e(this).parent().parent();if(!r.quiz_finished){r.do_answer(s,o);u.find("input").prop("checked",false);u.children("li").children("div").removeClass("chosen");u.addClass("answered");e(this).addClass("chosen");n.prop("checked",true)}t.preventDefault()})},make_checkbox:function(t,n,r){return e('<p><input id="'+r+","+n+'" name="'+r+","+n+'" type="checkbox"><label for="'+r+","+n+'">'+t.replace(/\[.*?\]/g,"")+"</label></p>")},make_image:function(t,n,i){var s=t.match(/\[(.*?)\]/);if(s){var o=e('<div class="answer_holder '+i+","+n+'"></div>'),u=e('<div class="img_holder"></div>');u.append('<img src="'+s[1]+'"/>');u.append(r.make_checkbox(t,n,i));o.append(u);r.do_bindings(o);return o}},make_questions:function(t,n){var i=e('<ol class="question_container question_'+n+'"></ol>');i.append(e("<h2>"+t.section+"</h2>"));i.append(r.make_answers_for_questions(t,n));s.append(i);i.append("<hr />");e(".answers_"+n+" > .answer_holder").shuffle()},make_answers_for_questions:function(t,n){var i=e('<li class="answer_container answers_'+n+'"></li>');var s=0;for(var o in t){if(o!="section"&&o!="rowNumber"){i.append(r.make_image(t[o],n,s));s++}}r.answers_array=r.build_answers_array(s);return i},make_quiz_from_tabletop:function(t){for(var n in t){var i=t[n].elements,o=i.slice(-Math.abs(i.length),i.length-2);results_data_array=t[n].toArray(),column_names=t[n].column_names,results_data=[results_data_array.pop(),results_data_array.pop()];for(var u=0;u<results_data.length;u++){results_data[u].shift()}r.results_array=results_data}for(var u=0;u<o.length;u++){var a=o[u];r.make_questions(a,u)}s.append(e('<div class="results hidden"></div>'));r.number_of_questions=o.length},tabletop_load:function(e){Tabletop.init({key:e,callback:function(e){var t=r.make_quiz_from_tabletop(e)}})}};return o.init(t,n)};e.fn.shuffle=function(){var t=this.get(),n=function(e){return Math.floor(Math.random()*e)},r=e.map(t,function(){var r=n(t.length),i=e(t[r]).clone(true)[0];t.splice(r,1);return i});this.each(function(t){e(this).replaceWith(e(r[t]))});return e(r)};e.fn.quizzify=function(t,n){if(!n){n={}}n.container=this.attr("id");this.quizzify=e.quizzify(t,n);return this}})(jQuery)
