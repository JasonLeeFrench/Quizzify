!function(a){a.quizzify=function(b,c){var d,e,f,g={container:"quiz_container",answers_array:[],results_array:[],number_of_questions:0,quiz_finished:!1,init:function(a,b){if(d=this,b)for(var c in b)d[c]=b[c];return"string"==typeof a&&d.tabletop_load(a),d.create_cover(),d},build_answers_array:function(a){return Array.apply(null,new Array(a)).map(Number.prototype.valueOf,0)},do_results:function(b,c){for(var d=c[1],e=c[0],f=a(".results"),g=[],h=b[0],i=0,j=1;j<b.length;j++)b[j]>h&&(i=j,h=b[j]);for(var j=0;j<b.length;j++)b[j]===h&&g.push(j);var k=g[Math.floor(Math.random()*g.length)];f.removeClass("hidden"),f.append(a("<h2>"+d[k]+"</h2>")),f.append(a("<p>"+e[k]+"</p>"))},do_answer:function(b,c){question_id=a(".question_"+c),question_id.hasClass("answered")&&(d.answers_array[parseInt(question_id.find("input:checked").attr("id").split(",")[0])]-=1),d.answers_array[b]+=1,d.total_answered(d.answers_array)===d.number_of_questions&&(d.do_results(d.answers_array,d.results_array),a(".quiz_container").addClass("complete"),a("html,body").animate({scrollTop:a(".results").offset().top},"slow"),d.quiz_finished=!0)},create_cover:function(){e=a("#"+d.container),f=a("<ul></ul>"),e.append(f),f.addClass("quiz_container"),f.css({width:f.parent().width()})},total_answered:function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b},do_bindings:function(b){b.on("click",function(b){var c=a(this).find("input"),e=c.attr("id").split(","),f=e[0],g=e[1],h=a(this).parent().parent();d.quiz_finished||(d.do_answer(f,g),h.find("input").prop("checked",!1),h.children("li").children("div").removeClass("chosen"),h.addClass("answered"),a(this).addClass("chosen"),c.prop("checked",!0)),b.preventDefault()})},make_checkbox:function(b,c,d){return a('<p><input id="'+d+","+c+'" name="'+d+","+c+'" type="checkbox"><label for="'+d+","+c+'">'+b.replace(/\[.*?\]/g,"")+"</label></p>")},make_image:function(b,c,e){var f=b.match(/\[(.*?)\]/);if(f){var g=a('<div class="answer_holder '+e+","+c+'"></div>'),h=a('<div class="img_holder"></div>');return h.append('<img src="'+f[1]+'"/>'),h.append(d.make_checkbox(b,c,e)),g.append(h),d.do_bindings(g),g}},make_questions:function(b,c){var e=a('<ol class="question_container question_'+c+'"></ol>');e.append(a("<h2>"+b.Section+"</h2>")),e.append(d.make_answers_for_questions(b,c)),f.append(e),e.append("<hr />"),a(".answers_"+c+" > .answer_holder").shuffle()},make_answers_for_questions:function(b,c){var e=a('<li class="answer_container answers_'+c+'"></li>'),f=0;for(var g in b)"section"!=g&&"rowNumber"!=g&&(e.append(d.make_image(b[g],c,f)),f++);return d.answers_array=d.build_answers_array(f),e},make_quiz_from_tabletop:function(b){for(var c in b){var e=b[c].elements,g=e.slice(-Math.abs(e.length),e.length-2);results_data_array=b[c].toArray(),column_names=b[c].column_names,results_data=[results_data_array.pop(),results_data_array.pop()];for(var h=0;h<results_data.length;h++)results_data[h].shift();d.results_array=results_data}for(var h=0;h<g.length;h++){var i=g[h];d.make_questions(i,h)}f.append(a('<div class="results hidden"></div>')),d.number_of_questions=g.length},tabletop_load:function(a){Tabletop.init({key:a,callback:function(a){d.make_quiz_from_tabletop(a)}})}};return g.init(b,c)},a.fn.shuffle=function(){var b=this.get(),c=function(a){return Math.floor(Math.random()*a)},d=a.map(b,function(){var d=c(b.length),e=a(b[d]).clone(!0)[0];return b.splice(d,1),e});return this.each(function(b){a(this).replaceWith(a(d[b]))}),a(d)},a.fn.quizzify=function(b,c){return c||(c={}),c.container=this.attr("id"),this.quizzify=a.quizzify(b,c),this}}(jQuery);
